---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(rvest)
library(htmltools)
library(here)
library(glue)

wiki_root_url <- "https://rupaulsdragrace.fandom.com/wiki/"
```

```{r initial url for testing, include=FALSE}
hytes_url <- glue("{wiki_root_url}Category:House_of_Hytes")
hytes_url
```

```{r initial html results for the hytes, include=FALSE}
hytes_results <-read_html(hytes_url)
hytes_results
```

```{r initial attempt to get all of the names of members, include=FALSE}
hytes_names <- hytes_results %>% 
  html_nodes(".category-page__member") %>% 
  html_text() %>% 
  str_replace_all( "[\t\n]" , "")
  hytes_names
```

```{r converting into a dataframe so I can try and make cartesian product, inclulde=FALSE}
hytes_names_df <- as.data.frame(hytes_names)
```

```{r working example of the linked data, include=FALSE}
hytes_family_nodes <- expand.grid(hytes_names_df[[1]],hytes_names_df[[1]]) %>% 
  rename( "queen_1"=1
         ,"queen_2"=2) %>% 
  mutate( drag_family="Hytes"
         ,drag_mother=hytes_names_df[[1]][1] )%>%
  select(drag_family,drag_mother,queen_1,queen_2) %>% 
  filter(queen_1!=queen_2) 
hytes_family_nodes
```

# House of Minj
```{r This would be too much work, echo=FALSE, include=FALSE, eval=FALSE }
minj_url <- glue("{wiki_root_url}Category:House_of_Minj")
minj_results <-read_html(minj_url)
minj_names <- minj_results %>% 
  html_nodes(".mw-parser-output") %>% 
  html_text()%>% 
  str_replace_all( "[\t\n]" , "") 
minj_names
```

# All Drag Families 

## Getting the data together 

Combined the root url with the Queens by drag house url and 
followed the pattern to extract the list of all url elements and 
tunred it into a data frame that to be combined with the rest of teh data 
```{r}
drag_house_url <- glue("{wiki_root_url}Category:Queens_by_Drag_House")
drag_house_results <- read_html(drag_house_url)

drag_house_names <- drag_house_results %>% 
  html_nodes(".category-page__member-link") %>% 
  html_text() 

drag_house_urls <-  drag_house_results %>% 
  html_nodes(".category-page__member") %>% 
  html_text("href")%>% 
  str_replace_all( "[\t\n]" , "") %>% 
  str_replace_all(" ","_") %>% 
  as.data.frame() %>% 
  rename("url_end"=1)

drag_house_frame <- tibble(wiki_root_url,drag_house_urls) %>% 
  mutate(family_url=as.character(glue("{wiki_root_url}{url_end}"))
         , family_name=str_replace(url_end,"Category:","")
         , family_name=str_replace_all(family_name,"_"," ")
         ) %>% 
  filter(url_end!="Category:House_of_Stupi") # this is an empty page
  # Not elegant, need to do some more reading on how to handle and empty element.
  # So far this has only happened for the house of stupi... hoping it is a one off 
  # might have to make this a running list.... or maybe =check out the results 
  # one second..

```

## First Attempt: Write a loop

I *KNOW* that a map function is better suited, but I needed to see how 
this data was coming in on my own.

Originally I thought it'd be easier to attach the resutls as list column in a 
dataframe, but I'm going to have to unnest and then pivot... so I think it will be 
easier to make a family data frame ( for all families ) and union all of the results
toghter. 

It would live on its own and can be updated when there are new queens 

```{r looping to get results, include=FALSE}
# n_row <- nrow(drag_house_frame)
# 
# for(i in 1:n_row){
#     results <- read_html(drag_house_frame$family_url[[i]] )
#     
#     result_string <-results %>% 
#     html_nodes(".category-page__member") %>% 
#     html_text() %>% 
#     str_replace_all( "[\t\n]" , "")
#  
#   drag_house_frame$all_names[[i]]=result_string
#     
# }

```
 
## Second Attempt: Use a MAP functoin 
```{r using map to get the html results, include=FALSE}
family_results <- tibble(   family_name=drag_house_frame$family_name
                          , html_results = map(drag_house_frame$family_url
                                                                        , ~ {.x %>%
                                                                                read_html()
                                                                             }
                                                                        )
) 
```

```{r using map to get all of the names in a list column, include=FALSE}
family_results <- family_results %>% 
  mutate(all_names=map(   family_results$html_results
                        , ~{.x %>% 
                              html_nodes(".category-page__member") %>% 
                              html_text() %>% 
                              str_replace_all( "[\t\n]" , "")
                            }
                       )
         )


```

