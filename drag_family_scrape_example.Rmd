---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(rvest)
library(htmltools)
library(here)
library(glue)

wiki_root_url <- "https://rupaulsdragrace.fandom.com/wiki/"
```

# All Drag Families 

## Getting the data together 

Combined the root url with the Queens by drag house url and 
followed the pattern to extract the list of all url elements and 
tunred it into a data frame that to be combined with the rest of teh data 

this is an empty page
Not elegant, need to do some more reading on how to handle and empty element.
So far this has only happened for the house of stupi... hoping it is a one off
might have to make this a running list.... or maybe =check out the results
one second..
gotta do the same for the template page... just empty
```{r}
drag_house_url <- glue("{wiki_root_url}Category:Queens_by_Drag_House")

drag_house_results <- read_html(drag_house_url)

drag_house_names <- drag_house_results %>% 
  html_nodes(".category-page__member-link") %>% 
  html_text() 

drag_house_urls <-  drag_house_results %>% 
  html_nodes(".category-page__member") %>% 
  html_text("href")%>% 
  str_replace_all( "[\t\n]" , "") %>% 
  str_replace_all(" ","_") %>% # cleaning up the URLs 
  as.data.frame() %>% 
  rename("url_end"=1)

drag_house_frame <- tibble(wiki_root_url,drag_house_urls) %>% 
  mutate(family_url=as.character(glue("{wiki_root_url}{url_end}"))
         , family_name=str_replace(url_end,"Category:","")
         , family_name=str_replace_all(family_name,"_"," ")
         ) %>% 
  filter(!(url_end %in% c("Category:House_of_Stupi","Category:Template_(Family_Tree)"))
         ) %>% 
  mutate( html_results = map( family_url
                             , ~ {.x %>%
                                     read_html()
                                  }
                             )
         , all_names=map( html_results
                        , ~{.x %>% 
                              html_nodes(".category-page__member") %>% 
                              html_text() %>% 
                              str_replace_all( "[\t\n]" , "")
                            }
                       )
         ) %>% 
  select(-html_results) %>% 
  unnest(all_names) 
         


```